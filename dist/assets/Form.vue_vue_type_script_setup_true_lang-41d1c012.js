import{a as T,_ as pe}from"./HeaderAlertView.vue_vue_type_script_setup_true_lang-e1c88155.js";import{e as fe,x as ve,y,z as ye,B as _e,o as _,c as C,d as e,h as o,w as a,R as $,K as p,L as n,H as x,T as g,b as c,a as m,a4 as B,g as O,m as b,I as L,V as k,E as X,a7 as be,a8 as Ve,a9 as ge,Q as N,O as D,F as E,P as Z,W as ke,t as he,D as xe,S as P}from"./index-dd53741e.js";import{u as Ce}from"./useSelect2Infite-f4f6a343.js";import{useCrudRequirementTypeStore as we}from"./useCrudRequirementTypeStore-a205818e.js";import{V as w}from"./VTooltip-c58f227b.js";import{V as ee}from"./VDataTable-d1d16a2f.js";const Ie=m("b",{class:"text-warning"},"*",-1),Oe={class:"demo-space-x"},Ue={class:"d-flex"},ze=m("b",{class:"text-vblack fs-6 me-auto"},"Cargos",-1),qe={class:"d-flex justify-content-center aling-items-center"},Te={key:0,class:"d-flex justify-content-between aling-items-center p-2"},$e={class:"d-flex"},Be=m("b",{class:"text-vblack fs-6 me-auto"},"Campos",-1),Se=m("b",{class:"text-warning"},"*",-1),Fe=m("b",{class:"text-warning"},"*",-1),Ae={class:"v-data-table__tr"},Le=["colspan"],Ne=["colspan"],De=m("b",null,"Esta tipo de input no posee opciones asociadas",-1),Ke=fe({__name:"Form",setup(Ee){const I=we(),{action:ae,formulario:u,charges_arrayInfo:S,charges_countLinks:le,loading:R}=ve(I),U=y([]),F=y(),Q=y(),j=y(),f=Ce(I.fetchSelectCharges,S),G=async s=>{var l;I.typeAction=s,K(),M(),await((l=F.value)==null?void 0:l.resetValidation()),U.value=[],s!="back"&&I.keyList++},te=async()=>{var l;const s=await((l=F.value)==null?void 0:l.validate());if(s!=null&&s.valid){const V=await I.fetchSave();V.code===200&&G("list"),V.code===422&&(U.value=V.errors??[])}};ye(async()=>{await I.fetchDataForm(),f.dataNueva.value=S.value,f.totalLinks.value=le.value});const v=y({charge:null,order:null}),H=y(),A=[{title:"Cargo",key:"name"},{title:"Orden",key:"order"},{title:"Acciones",sortable:!1,key:"actions"}],K=()=>{v.value={charge:null,order:null}},oe=async()=>{var l;const s=await((l=H.value)==null?void 0:l.validate());if(s!=null&&s.valid){const V=u.value.arrayCharges.find(d=>d.charge_id==v.value.charge),t=u.value.arrayCharges.find(d=>d.order==v.value.order),r=S.value.find(d=>d.id==v.value.charge);if(t)return P.fire("Ya existe un cargo con el número orden "+v.value.order),!1;if(V)return P.fire("Ya existe este cargo agregado"),!1;u.value.arrayCharges.push({charge_id:r==null?void 0:r.id,name:r==null?void 0:r.name,order:v.value.order}),K()}},se=s=>{u.value.arrayCharges.splice(s,1)},W=[1,5],i=y({label:null,type_input:null,required:0}),z=y({name:null}),h=y([]),Y=y([{value:1,title:"text"},{value:2,title:"select"},{value:3,title:"checkbox"},{value:4,title:"radio"},{value:5,title:"file"}]),q=_e(()=>u.value.arrayInputs.filter(s=>s.delete!="delete")),re=[{title:"",key:"data-table-expand",sortable:!1},{title:"Label",key:"label",sortable:!1},{title:"Obligatorio",key:"required",sortable:!1},{title:"Tipo de input",key:"type_name",sortable:!1},{title:"Acciones",key:"actions",sortable:!1}],ne=()=>{h.value=[]},ue=async()=>{var l;const s=await((l=Q.value)==null?void 0:l.validate());if(s!=null&&s.valid){if(!W.includes(i.value.type_input)&&h.value.length==0)return P.fire("Debe agregar almenos una opción  al input"),!1;const V=Y.value.find(t=>t.value==i.value.type_input);u.value.arrayInputs.push({label:i.value.label,type_input:i.value.type_input,required:i.value.required,type_name:V.title,arrayOptions:[]}),h.value.forEach(t=>{u.value.arrayInputs[u.value.arrayInputs.length-1].arrayOptions.push(t)}),M()}},M=async()=>{i.value={label:null,type_input:null,required:0}},ie=async s=>{u.value.arrayInputs[s].id?u.value.arrayInputs[s].delete="delete":u.value.arrayInputs.splice(s,1)},de=async()=>{var l;const s=await((l=j.value)==null?void 0:l.validate());s!=null&&s.valid&&(h.value.push({name:z.value.name}),z.value={name:null})},ce=async s=>{h.value[s].id?h.value[s].delete="delete":h.value.splice(s,1)},me=async(s,l)=>{q.value[s].arrayOptions[l].id?q.value[s].arrayOptions[l].delete="delete":q.value[s].arrayOptions.splice(l,1)};return(s,l)=>{const V=pe;return _(),C("div",null,[e(V,{"sub-title":"Tipo de solicitud",action:o(ae),"validate-crud":!0,"btn-back":!0,onChangeScreenBack:G},null,8,["action"]),e(xe,{class:"bg-vwhite",fluid:""},{default:a(()=>[e($,{ref_key:"formValidation",ref:F,"lazy-validation":""},{default:a(()=>[e(p,null,{default:a(()=>[e(n,{cols:"12",sm:"6"},{default:a(()=>[e(x,{clearable:"",modelValue:o(u).name,"onUpdate:modelValue":l[0]||(l[0]=t=>o(u).name=t),rules:[o(g)],"error-messages":o(U).name,onKeypress:l[1]||(l[1]=t=>o(U).name="")},{label:a(()=>[c(" Nombre "),Ie]),_:1},8,["modelValue","rules","error-messages"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:a(()=>[m("div",Oe,[e(B,{modelValue:o(u).internal,"onUpdate:modelValue":l[2]||(l[2]=t=>o(u).internal=t),"true-value":1,"false-value":0,label:"Interno"},null,8,["modelValue"]),e(B,{modelValue:o(u).external,"onUpdate:modelValue":l[3]||(l[3]=t=>o(u).external=t),"true-value":1,"false-value":0,label:"Externo"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1},512),e($,{ref_key:"formPivotValidation",ref:H,"lazy-validation":""},{default:a(()=>[e(p,null,{default:a(()=>[e(n,{cols:"12",class:"pb-0"},{default:a(()=>[e(O,{class:"border-opacity-75 mb-3",color:"csecundary",thickness:3}),m("div",Ue,[e(T,{class:"w-100"},{default:a(()=>[ze]),_:1}),e(T,null,{default:a(()=>[e(w,{text:"Cargo",location:"top"},{activator:a(({props:t})=>[e(b,L({class:"ms-1",color:"light",rounded:"lg"},t,{onClick:l[4]||(l[4]=r=>oe())}),{default:a(()=>[c(" Agregar  "),e(k,{size:"large",color:"success",icon:"mdi-plus"})]),_:2},1040)]),_:1})]),_:1})])]),_:1}),e(n,{cols:"12",sm:"6",md:"4"},{default:a(()=>[e(X,{clearable:"","item-title":"name",label:"Cargo","item-value":"id",items:o(f).dataNueva.value,modelValue:o(v).charge,"onUpdate:modelValue":l[8]||(l[8]=t=>o(v).charge=t),rules:[o(g)]},{"prepend-item":a(()=>[e(x,{placeholder:"Buscar...",class:"mb-2",modelValue:o(f).searchQuery.value,"onUpdate:modelValue":l[5]||(l[5]=t=>o(f).searchQuery.value=t)},null,8,["modelValue"]),e(O)]),"append-item":a(()=>[e(O),m("div",qe,[be(e(Ve,{size:"24",color:"primary",indeterminate:""},null,512),[[ge,o(R)]])]),o(R)?N("",!0):(_(),C("div",Te,[m("div",null,[e(b,{class:"mt-2",disabled:o(f).page.value<=1,onClick:l[6]||(l[6]=t=>o(f).prev()),color:"success"},{default:a(()=>[e(k,{icon:"mdi-chevron-left"})]),_:1},8,["disabled"]),e(b,{class:"mt-2",disabled:o(f).page.value>=o(f).totalLinks.value,onClick:l[7]||(l[7]=t=>o(f).next()),color:"success"},{default:a(()=>[e(k,{icon:"mdi-chevron-right"})]),_:1},8,["disabled"])])]))]),_:1},8,["items","modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6",md:"4"},{default:a(()=>[e(x,{type:"number",clearable:"",modelValue:o(v).order,"onUpdate:modelValue":l[9]||(l[9]=t=>o(v).order=t),rules:[o(g)],label:"Orden"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(o(ee),{headers:A,"items-per-page":"999",items:o(u).arrayCharges},{"item.actions":a(({item:t,index:r})=>[e(b,{size:"x-small",color:"error",variant:"text",icon:"",onClick:d=>se(r)},{default:a(()=>[e(k,{size:"22",icon:"tabler-trash"}),e(w,{activator:"parent",location:"top"},{default:a(()=>[c("Borrar")]),_:1})]),_:2},1032,["onClick"])]),bottom:a(()=>[]),_:1},8,["items"])]),_:1},512),e($,{ref_key:"formInputValidation",ref:Q,"lazy-validation":""},{default:a(()=>[e(p,null,{default:a(()=>[e(n,{cols:"12",class:"pb-0"},{default:a(()=>[e(O,{class:"border-opacity-75 mb-3",color:"csecundary",thickness:3}),m("div",$e,[e(T,{class:"w-100"},{default:a(()=>[Be]),_:1}),e(T,null,{default:a(()=>[e(w,{text:"Campo",location:"top"},{activator:a(({props:t})=>[e(b,L({class:"ms-1",color:"light",rounded:"lg"},t,{onClick:l[10]||(l[10]=r=>ue())}),{default:a(()=>[c(" Agregar  "),e(k,{size:"large",color:"success",icon:"mdi-plus"})]),_:2},1040)]),_:1})]),_:1})])]),_:1}),e(n,{cols:"12",sm:"6",md:"4"},{default:a(()=>[e(x,{modelValue:o(i).label,"onUpdate:modelValue":l[11]||(l[11]=t=>o(i).label=t),rules:[o(g)]},{label:a(()=>[c(" Nombre del campo "),Se]),_:1},8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"6",md:"4"},{default:a(()=>[e(X,{clearable:"",rules:[o(g)],"onUpdate:modelValue":[l[12]||(l[12]=t=>ne()),l[13]||(l[13]=t=>o(i).type_input=t)],items:o(Y),modelValue:o(i).type_input},{label:a(()=>[c(" Tipo de campo "),Fe]),_:1},8,["rules","items","modelValue"])]),_:1}),e(n,{cols:"6",sm:"6",md:"4"},{default:a(()=>[e(B,{label:"Obligatorio",modelValue:o(i).required,"onUpdate:modelValue":l[14]||(l[14]=t=>o(i).required=t),"true-value":1,"false-value":0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512),o(i).type_input&&!W.includes(o(i).type_input)?(_(),D($,{key:0,ref_key:"formOptionValidation",ref:j,"lazy-validation":""},{default:a(()=>[e(p,null,{default:a(()=>[e(n,{cols:"12",sm:"4"},{default:a(()=>[e(x,{clearable:"",modelValue:o(z).name,"onUpdate:modelValue":l[15]||(l[15]=t=>o(z).name=t),rules:[o(g)],label:"Opción"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"4"},{default:a(()=>[e(b,{onClick:l[16]||(l[16]=t=>de())},{default:a(()=>[c(" Agregar Opción ")]),_:1})]),_:1})]),_:1}),(_(!0),C(E,null,Z(o(h),(t,r)=>(_(),D(p,{key:r},{default:a(()=>[e(n,{cols:"12",sm:"4"},{default:a(()=>[e(x,{modelValue:t.name,"onUpdate:modelValue":d=>t.name=d,rules:[o(g)],label:"Opción #"+(r+1)},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),e(n,{cols:"12",sm:"4"},{default:a(()=>[e(b,{size:"x-small",color:"error",variant:"text",icon:"",onClick:d=>ce(r)},{default:a(()=>[e(k,{size:"22",icon:"tabler-trash"}),e(w,{activator:"parent",location:"top"},{default:a(()=>[c("Borrar")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},512)):N("",!0),e(p,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(o(ee),{headers:re,items:o(q)},{"item.actions":a(({item:t,index:r})=>[e(b,{size:"x-small",color:"error",variant:"text",icon:"",onClick:d=>ie(r)},{default:a(()=>[e(k,{size:"22",icon:"tabler-trash"}),e(w,{activator:"parent",location:"top"},{default:a(()=>[c("Borrar")]),_:1})]),_:2},1032,["onClick"])]),"expanded-row":a(t=>[m("tr",Ae,[t.item.raw.arrayOptions.length>0?(_(),C("td",{key:0,colspan:A.length},[(_(!0),C(E,null,Z(t.item.raw.arrayOptions,(r,d)=>(_(),D(p,{class:"my-1",key:d},{default:a(()=>[r.delete?N("",!0):(_(),C(E,{key:0},[e(n,{cols:"1"},{default:a(()=>[e(ke,null,{default:a(()=>[c("Opción "+he(d+1)+" : ",1)]),_:2},1024)]),_:2},1024),e(n,{cols:"12",sm:"4"},{default:a(()=>[e(x,{clearable:"",modelValue:r.name,"onUpdate:modelValue":J=>r.name=J,rules:[o(g)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(n,{cols:"12",sm:"4"},{default:a(()=>[e(b,{size:"x-small",color:"error",variant:"text",icon:"",onClick:J=>me(t.index,d)},{default:a(()=>[e(k,{size:"22",icon:"tabler-trash"}),e(w,{activator:"parent",location:"top"},{default:a(()=>[c("Borrar")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)],64))]),_:2},1024))),128))],8,Le)):(_(),C("td",{key:1,colspan:A.length},[e(p,{class:"my-1"},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[De]),_:1})]),_:1})],8,Ne))])]),"item.label":a(({item:t})=>[e(p,{class:"my-5"},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(x,{clearable:"",modelValue:t.raw.label,"onUpdate:modelValue":r=>t.raw.label=r,rules:[o(g)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]),_:2},1024)]),"item.required":a(({item:t})=>[e(p,{class:"my-5"},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(B,{modelValue:t.raw.required,"onUpdate:modelValue":r=>t.raw.required=r,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),bottom:a(()=>[]),_:1},8,["items"])]),_:1})]),_:1}),e(O,{class:"border-opacity-75 my-4",color:"cprimary",thickness:3}),e(p,{class:"pt-0"},{default:a(()=>[e(n,{cols:"12",class:"text-center"},{default:a(()=>[e(w,{text:"Guardar",location:"top"},{activator:a(({props:t})=>[e(b,L({class:"ms-1",color:"light",rounded:"lg"},t,{onClick:l[17]||(l[17]=r=>te())}),{default:a(()=>[c(" Guardar  "),e(k,{size:"large",color:"success",icon:"mdi-content-save-outline"})]),_:2},1040)]),_:1})]),_:1})]),_:1})]),_:1})])}}});export{Ke as _};
