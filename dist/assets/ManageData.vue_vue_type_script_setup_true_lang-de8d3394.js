import{e as se,u as ne,x as ue,y as m,$ as L,B as de,o as d,c as $,d as e,w as a,L as n,m as x,b as V,K as f,h as t,O as v,Q as p,U as ce,T as b,R as D,a0 as R,H as me,V as I,E as O,t as Q,F as fe,P as ve,a as P,aa as ye}from"./index-dd53741e.js";import{_ as _e}from"./InfoRequeriment.vue_vue_type_script_setup_true_lang-8e36c08e.js";import{useRequirementStore as ke}from"./useRequirementStore-9d46e190.js";import{V as H}from"./VTooltip-c58f227b.js";import{V as K}from"./VDataTable-d1d16a2f.js";const Ve=P("h3",null,"Trazabilidad",-1),pe=["href","download"],xe=se({__name:"ManageData",setup(be){const N=ne(),y=ke(),{formularioManage:_,charges:g,arrayAction:W,dataTraceability:J,requirementData:z}=ue(y),A=m([]),h=m(),U=m(),M=m(),k=m(L()),F=m(L()),u=m({}),S=m([]),T=async r=>{y.typeAction=r,r!="back"&&y.keyList++},X=async(r="save")=>{var c,i;const l=await((c=h.value)==null?void 0:c.validate());if(l!=null&&l.valid){const s=await y.fetchManageSave();s.code===200&&(await((i=h.value)==null?void 0:i.resetValidation()),A.value=[],y.clearFormularioManage(),r=="saveAndBack"&&T("list")),s.code===422&&(A.value=s.errors??[])}},Y=async()=>{var l,c,i;const r=await((l=h.value)==null?void 0:l.validate());if(r!=null&&r.valid){const s=await((c=M.value)==null?void 0:c.validate());s!=null&&s.valid&&(u.value.archive_final=null,F.value.imageFile&&(u.value.archive_final=F.value.imageFile),(await y.fetchManageSave(u.value)).code===200&&(await((i=h.value)==null?void 0:i.resetValidation()),A.value=[],y.clearFormularioManage(),T("list"))),data.code===422&&(A.value=data.errors??[])}},Z=[{title:"Nombre",key:"name"},{title:"Acciones",sortable:!1,key:"actions"}],ee=de(()=>_.value.files.filter(r=>r.delete!="delete")),ae=()=>{k.value.clearData()},le=async()=>{var l;const r=await((l=U.value)==null?void 0:l.validate());r!=null&&r.valid&&(_.value.files.push({file:k.value.imageFile,name:k.value.name,delete:null,id:null}),ae())},te=r=>{_.value.files[r].id?_.value.files[r].delete="delete":_.value.files.splice(r,1)},B=m(!0),E=m("Guardar y Ejecutar"),re=r=>{B.value=!0;const l=g.value.findIndex(i=>i.id==N.user.charge_id),c=g.value[g.value.length-1];if(u.value.action=r,r=="Devolver"&&(u.value.where=null,S.value=g.value.filter((i,s)=>s<l)),r=="Continuar"){c.id==N.user.charge_id&&(E.value="Guardar y Finalizar",B.value=!1,u.value.action="Finalizar"),u.value.where=null;const i=l+1;S.value=g.value.filter((s,w)=>w==i)}},oe=[{title:"Cargo",key:"charge_name"},{title:"Usuario",key:"user_name"},{title:"ObservaciÃ³n",key:"observation"},{title:"Archivos",key:"files"},{title:"Fecha",key:"date"}],ie=()=>{u.value.action=null,E.value="Guardar y Ejecutar"};return(r,l)=>{var c,i,s,w,j,q;return d(),$("div",null,[e(f,null,{default:a(()=>[e(n,{cols:"12",class:"d-flex justify-content-end"},{default:a(()=>[e(x,{color:"secondary",onClick:l[0]||(l[0]=o=>T("back"))},{default:a(()=>[V(" Atras ")]),_:1})]),_:1})]),_:1}),t(z)?(d(),v(f,{key:0},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(_e)]),_:1})]),_:1})):p("",!0),((i=(c=t(z))==null?void 0:c.state)==null?void 0:i.id)!=3?(d(),v(D,{key:1,ref_key:"formValidation",ref:h,"lazy-validation":""},{default:a(()=>[e(f,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(ce,{modelValue:t(_).observation,"onUpdate:modelValue":l[1]||(l[1]=o=>t(_).observation=o),label:"Observaciones",rules:[t(b)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)):p("",!0),((w=(s=t(z))==null?void 0:s.state)==null?void 0:w.id)!=3?(d(),v(D,{key:2,ref_key:"formFileValidation",ref:U,"lazy-validation":""},{default:a(()=>[e(f,null,{default:a(()=>[e(n,{cols:"12",sm:"4"},{default:a(()=>[(d(),v(R,{onChange:t(k).handleImageSelected,rules:[t(b)],key:t(k).key},null,8,["onChange","rules"]))]),_:1}),e(n,{cols:"12",sm:"4"},{default:a(()=>[e(me,{clearable:"",modelValue:t(k).name,"onUpdate:modelValue":l[2]||(l[2]=o=>t(k).name=o),rules:[t(b)],label:"Nombre"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",sm:"4"},{default:a(()=>[e(x,{color:"primary",icon:"",size:"35",onClick:l[3]||(l[3]=o=>le())},{default:a(()=>[e(I,{icon:"tabler-plus"}),e(H,{activator:"parent",location:"top"},{default:a(()=>[V("Agregar Archivo")]),_:1})]),_:1})]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(t(K),{headers:Z,"items-per-page":"999",items:t(ee)},{"item.actions":a(({item:o,index:C})=>[e(x,{size:"x-small",color:"error",variant:"text",icon:"",onClick:G=>te(C)},{default:a(()=>[e(I,{size:"22",icon:"tabler-trash"}),e(H,{activator:"parent",location:"top"},{default:a(()=>[V("Borrar")]),_:1})]),_:2},1032,["onClick"])]),bottom:a(()=>[]),_:1},8,["items"])]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(n,{cols:"12 d-flex justify-content-center"},{default:a(()=>[e(x,{color:"primary",onClick:l[4]||(l[4]=o=>X("saveAndBack"))},{default:a(()=>[V("Guardar y salir")]),_:1})]),_:1})]),_:1})]),_:1},512)):p("",!0),((q=(j=t(z))==null?void 0:j.state)==null?void 0:q.id)!=3?(d(),v(D,{key:3,ref_key:"formExecuteValidation",ref:M,"lazy-validation":""},{default:a(()=>[e(f,null,{default:a(()=>[e(n,{cols:"12",sm:"4"},{default:a(()=>[e(O,{rules:[t(b)],clearable:"",label:"Que hacer","onClick:clear":l[5]||(l[5]=o=>ie()),"onUpdate:modelValue":l[6]||(l[6]=o=>re(o)),items:t(W)},null,8,["rules","items"])]),_:1}),t(B)?(d(),v(n,{key:0,cols:"12",sm:"4"},{default:a(()=>[e(O,{rules:[t(b)],clearable:"",label:"A donde","item-value":"id","item-title":"name",items:t(S),modelValue:t(u).where,"onUpdate:modelValue":l[7]||(l[7]=o=>t(u).where=o)},null,8,["rules","items","modelValue"])]),_:1})):p("",!0),t(u).action=="Finalizar"?(d(),v(n,{key:1,cols:"12",sm:"4"},{default:a(()=>[(d(),v(R,{onChange:t(F).handleImageSelected,"onClick:clear":t(F).clearData,rules:[t(b)],key:t(F).key},null,8,["onChange","onClick:clear","rules"]))]),_:1})):p("",!0),e(n,{cols:"12",sm:"4"},{default:a(()=>[e(x,{color:"primary",onClick:l[8]||(l[8]=o=>Y())},{default:a(()=>[V(Q(t(E)),1)]),_:1})]),_:1})]),_:1})]),_:1},512)):p("",!0),e(f,{class:"mt-5"},{default:a(()=>[e(n,null,{default:a(()=>[Ve,e(t(K),{headers:oe,items:t(J),"items-per-page":99999999},{"item.files":a(({item:o})=>[(d(!0),$(fe,null,ve(o.raw.files,(C,G)=>(d(),$("div",{class:"d-flex flex-column my-2",key:G},[P("a",{class:"my-2",href:C.path,target:"_blank",download:C.name},[e(ye,{color:"primary",style:{cursor:"pointer"}},{default:a(()=>[e(I,{start:"",size:"16",icon:"tabler-download"}),V(" "+Q(C.name),1)]),_:2},1024)],8,pe)]))),128))]),bottom:a(()=>[]),_:1},8,["items"])]),_:1})]),_:1})])}}});export{xe as _};
