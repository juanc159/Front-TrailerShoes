import{_ as E}from"./HeaderAlertView.vue_vue_type_script_setup_true_lang-e1c88155.js";import{e as I,u as Q,x as j,y as w,z as G,A as T,B as H,o as f,c as _,d as e,C as J,h as s,w as o,a as p,m as v,V as m,b as d,Q as h,D as K,E as O,G as b,H as W,O as X,I as Y,J as Z,K as ee,L as $,t as te,S as ae}from"./index-dd53741e.js";import{P as oe}from"./PreloadInterno-a5d99930.js";import{useRequirementStore as le}from"./useRequirementStore-9d46e190.js";import{V as g}from"./VTooltip-c58f227b.js";import{V as se}from"./VSpacer-ddef0a47.js";import{V as ie}from"./VPagination-8df84faf.js";import{V as ne}from"./VDataTable-d1d16a2f.js";const re={key:0},ce={key:1},de=["href"],ue={key:3},fe={colspan:"4"},pe={style:{width:"100"},class:"d-flex justify-content-center"},me={class:"me-3",style:{width:"80px"}},_e={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},ve={style:{width:"10rem"}},be=I({__name:"TableList",setup(he){const i=le(),r=Q(),{action:A,requirements:k,totalPage:S,lastPage:M,currentPage:n,totalData:F,loading:N}=j(i),c=w(10),u=w(""),B=w(""),z=w(""),y=async()=>{var t,x,a;let l={perPage:c.value,page:n.value,searchQuery:u.value,sort_direction:B.value,sort_field:z.value};l.charge_id=(t=r.user)==null?void 0:t.charge_id,((x=r.user)==null?void 0:x.role_id)==2&&(l.user_id=(a=r.user)==null?void 0:a.id),await i.fetchAll(l)},q=[{title:"Id",key:"id"},{title:"Tipo",key:"type"},{title:"Estado",key:"state"},{title:"Acciones",sortable:!1,key:"actions"}];G(async()=>{await y()});const L=async l=>{l.length>0&&(B.value=l[0].order,z.value=l[0].key,await y())};T([u,c],async()=>{n.value=1}),T([n,u,c],async()=>{await y()});const R=H(()=>{const l=k.value.length?(n.value-1)*S.value+1:0,t=k.value.length+(n.value-1)*S.value;return`Mostrando ${l} a ${t} de ${F.value} registros`}),V=async(l,t=null)=>{A.value=t==null?"new":"edit",i.clearFormularioManage(),i.disabled=!1,i.clearFormulario(),i.typeAction=l,t&&l=="ManageData"&&i.fetchManageDataForm({requirement_id:t}),t&&l=="form"&&i.fetchInfo(t)},U=async l=>{ae.fire({title:"¿Desea eliminar el registro?",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Si",denyButtonText:"No"}).then(async t=>{t.isConfirmed?(await i.fetchDelete(l),await y()):t.isDenied})};return(l,t)=>{const x=E;return f(),_("div",null,[e(x,{title:"Listado","sub-title":"Solicitudes",icon:"mdi-format-list-bulleted"}),e(s(ne),{headers:q,items:s(k),"items-per-page":s(c),"onUpdate:sortBy":L},J({"item.actions":o(({item:a})=>{var C,P;return[(C=s(r).user)!=null&&C.charge_id&&a.props.title.state_id==3?(f(),_("div",re,[e(v,{icon:"",size:"x-small",color:"default",variant:"text",onClick:D=>V("ManageData",a.value)},{default:o(()=>[e(m,{size:"22",icon:"tabler-eye"}),e(g,{activator:"parent",location:"top"},{default:o(()=>[d(" Visualizar ")]),_:1})]),_:2},1032,["onClick"])])):h("",!0),a.props.title.state_id!=3&&((P=s(r).user)!=null&&P.charge_id)?(f(),_("div",ce,[e(v,{size:"x-small",color:"error",variant:"text",icon:"",onClick:D=>U(a.value)},{default:o(()=>[e(m,{size:"22",icon:"tabler-trash"}),e(g,{activator:"parent",location:"top"},{default:o(()=>[d(" Borrar ")]),_:1})]),_:2},1032,["onClick"]),e(v,{icon:"",size:"x-small",color:"default",variant:"text",onClick:D=>V("ManageData",a.value)},{default:o(()=>[e(m,{size:"22",icon:"tabler-settings"}),e(g,{activator:"parent",location:"top"},{default:o(()=>[d(" Gestionar ")]),_:1})]),_:2},1032,["onClick"])])):h("",!0),a.raw.archive_final?(f(),_("a",{key:2,href:a.raw.archive_final,download:"Documento Final",target:"_blank"},[e(m,{icon:"mdi-download"}),d(" Descargar ")],8,de)):h("",!0),s(r).permissions.includes("petition.index")?(f(),_("div",ue,[e(v,{icon:"",size:"x-small",color:"default",variant:"text",onClick:D=>V("form",a.value)},{default:o(()=>[e(m,{size:"22",icon:"tabler-eye"}),e(g,{activator:"parent",location:"top"},{default:o(()=>[d(" Visualizar ")]),_:1})]),_:2},1032,["onClick"])])):h("",!0)]}),top:o(()=>[e(K,{fluid:"",class:"d-flex flex-wrap py-4 gap-4"},{default:o(()=>[p("div",me,[e(O,{modelValue:s(c),"onUpdate:modelValue":t[0]||(t[0]=a=>b(c)?c.value=a:null),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"])]),e(se),p("div",_e,[p("div",ve,[e(W,{modelValue:s(u),"onUpdate:modelValue":t[1]||(t[1]=a=>b(u)?u.value=a:null),placeholder:"Buscar",density:"compact"},null,8,["modelValue"])]),e(g,{text:"Solicitud",location:"top"},{activator:o(({props:a})=>[s(r).permissions.includes("petition.index")?(f(),X(v,Y({key:0,class:"ms-1",color:"light",rounded:"lg"},a,{onClick:t[2]||(t[2]=C=>V("form"))}),{default:o(()=>[d(" Crear  "),e(m,{size:"large",color:"success",icon:"mdi-plus"})]),_:2},1040)):h("",!0)]),_:1})])]),_:1})]),bottom:o(()=>[e(Z,{class:"pt-2"},{default:o(()=>[e(ee,null,{default:o(()=>[e($,{lg:"4",cols:"3"},{default:o(()=>[d(te(s(R)),1)]),_:1}),e($,{lg:"8",cols:"9",class:"d-flex justify-end"},{default:o(()=>[e(ie,{modelValue:s(n),"onUpdate:modelValue":t[3]||(t[3]=a=>b(n)?n.value=a:null),"total-visible":5,size:"small",length:s(M)},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:2},[s(N).table?{name:"body",fn:o(()=>[p("tr",null,[p("td",fe,[p("div",pe,[e(oe)])])])]),key:"0"}:void 0]),1032,["items","items-per-page"])])}}});export{be as _};
