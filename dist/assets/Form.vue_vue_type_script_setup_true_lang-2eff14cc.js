import{_ as H}from"./AppDateTimePicker.vue_vue_type_style_index_0_lang-8ea98ac5.js";import{i as J,s as W,r as y,l as X,o as v,c as g,d as e,p as a,C as n,q as b,b as V,B as d,Q as O,z as x,n as t,L as f,K as w,x as Y,R as D,O as z,P as B,V as F,T as Z,a as L,t as ee,S as ae}from"./index-c9350ca5.js";import{useCrudSurveyStore as le}from"./useCrudSurveyStore-4fe69ad4.js";import{V as A}from"./VTextarea-7e773ba2.js";import{V as N}from"./VTooltip-7bf3ee5c.js";import{V as te}from"./VDataTable-1f115dfc.js";const oe={class:"v-data-table__tr"},se=["colspan"],ne=["colspan"],re=L("b",null,"Esta tipo de pregunta no posee opciones asociadas",-1),ye=J({__name:"Form",setup(ue){const k=le(),{formulario:r}=W(k),m=y([]),C=y(),T=y(),U=y(),$=async s=>{var l;k.typeAction=s,await((l=C.value)==null?void 0:l.resetValidation()),m.value=[],s!="back"&&k.keyList++},P=async()=>{var l;const s=await((l=C.value)==null?void 0:l.validate());if(s!=null&&s.valid){const c=await k.fetchSave();c.code===200&&$("list"),c.code===422&&(m.value=c.errors??[])}},u=y({question:null,type_question:null}),q=y({name:null}),p=y([]),S=y([{value:1,title:"Abierta"},{value:2,title:"Cerrada"},{value:3,title:"Multiple"}]),E=async()=>{u.value={question:null,type_question:null,arrayOptions:[]}},K=async()=>{var l;const s=await((l=T.value)==null?void 0:l.validate());if(s!=null&&s.valid){if(u.value.type_question!=1&&p.value.length==0)return ae.fire("Debe agregar almenos una opción  a la pregunta"),!1;const c=S.value.find(o=>o.value==u.value.type_question);r.value.arrayQuestions.push({question:u.value.question,type_question:u.value.type_question,type_name:c.title,arrayOptions:[]}),p.value.forEach(o=>{r.value.arrayQuestions[r.value.arrayQuestions.length-1].arrayOptions.push(o)}),E()}},R=async s=>{r.value.arrayQuestions[s].id?r.value.arrayQuestions[s].delete="delete":r.value.arrayQuestions.splice(s,1)},j=X(()=>r.value.arrayQuestions.filter(s=>s.delete!="delete")),Q=[{title:"",key:"data-table-expand",sortable:!1},{title:"Pregunta",key:"question",sortable:!1},{title:"Tipo de pregunta",key:"type_name",sortable:!1},{title:"Acciones",key:"actions",sortable:!1}],h=async()=>{var l;const s=await((l=U.value)==null?void 0:l.validate());s!=null&&s.valid&&(p.value.push({name:q.value.name}),q.value={name:null})},G=async s=>{p.value[s].id?p.value[s].delete="delete":p.value.splice(s,1)},I=()=>{p.value=[]};return(s,l)=>{const c=H;return v(),g("div",null,[e(d,null,{default:a(()=>[e(n,{cols:"12",class:"d-flex justify-content-end"},{default:a(()=>[e(b,{color:"secondary",onClick:l[0]||(l[0]=o=>$("back"))},{default:a(()=>[V(" Atras ")]),_:1})]),_:1})]),_:1}),e(w,{ref_key:"formValidation",ref:C,"lazy-validation":""},{default:a(()=>[e(d,null,{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(O,{class:"mb-1 text-body-2 text-high-emphasis",text:"Nombre"}),e(x,{modelValue:t(r).name,"onUpdate:modelValue":l[1]||(l[1]=o=>t(r).name=o),rules:[t(f)],"error-messages":t(m).name,onKeypress:l[2]||(l[2]=o=>t(m).name="")},null,8,["modelValue","rules","error-messages"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(c,{modelValue:t(r).startDate,"onUpdate:modelValue":l[3]||(l[3]=o=>t(r).startDate=o),rules:[t(f)],"error-messages":t(m).startDate,onChange:l[4]||(l[4]=o=>t(m).startDate=""),label:"Fecha inicio"},null,8,["modelValue","rules","error-messages"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(c,{modelValue:t(r).endDate,"onUpdate:modelValue":l[5]||(l[5]=o=>t(r).endDate=o),rules:[t(f)],"error-messages":t(m).endDate,onChange:l[6]||(l[6]=o=>t(m).endDate=""),label:"Fecha fin"},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1})]),_:1},512),e(w,{ref_key:"formQuestionValidation",ref:T,"lazy-validation":""},{default:a(()=>[e(d,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(O,{class:"mb-1 text-body-2 text-high-emphasis",text:"Pregunta"}),e(A,{clearable:"",modelValue:t(u).question,"onUpdate:modelValue":l[7]||(l[7]=o=>t(u).question=o),rules:[t(f)]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(d,null,{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(Y,{clearable:"",rules:[t(f)],"onUpdate:modelValue":[l[8]||(l[8]=o=>I()),l[9]||(l[9]=o=>t(u).type_question=o)],items:t(S),modelValue:t(u).type_question,label:"Tipo de pregunta"},null,8,["rules","items","modelValue"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(b,{onClick:l[10]||(l[10]=o=>K())},{default:a(()=>[V(" Agregar Pregunta ")]),_:1})]),_:1})]),_:1})]),_:1},512),t(u).type_question&&t(u).type_question!=1?(v(),D(w,{key:0,ref_key:"formOptionValidation",ref:U,"lazy-validation":""},{default:a(()=>[e(d,null,{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(x,{clearable:"",modelValue:t(q).name,"onUpdate:modelValue":l[11]||(l[11]=o=>t(q).name=o),rules:[t(f)],label:"Opción"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(b,{onClick:l[12]||(l[12]=o=>h())},{default:a(()=>[V(" Agregar Opción ")]),_:1})]),_:1})]),_:1}),(v(!0),g(z,null,B(t(p),(o,i)=>(v(),D(d,{key:i},{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(x,{modelValue:o.name,"onUpdate:modelValue":_=>o.name=_,rules:[t(f)],label:"Opción #"+(i+1)},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),e(n,{cols:"4"},{default:a(()=>[e(b,{size:"x-small",color:"error",variant:"text",icon:"",onClick:_=>G(i)},{default:a(()=>[e(F,{size:"22",icon:"tabler-trash"}),e(N,{activator:"parent",location:"top"},{default:a(()=>[V("Borrar")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},512)):Z("",!0),e(d,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(t(te),{headers:Q,items:t(j)},{"item.actions":a(({item:o,index:i})=>[e(b,{size:"x-small",color:"error",variant:"text",icon:"",onClick:_=>R(i)},{default:a(()=>[e(F,{size:"22",icon:"tabler-trash"}),e(N,{activator:"parent",location:"top"},{default:a(()=>[V("Borrar")]),_:1})]),_:2},1032,["onClick"])]),"expanded-row":a(o=>[L("tr",oe,[o.item.raw.arrayOptions.length>0?(v(),g("td",{key:0,colspan:Q.length},[(v(!0),g(z,null,B(o.item.raw.arrayOptions,(i,_)=>(v(),D(d,{class:"my-1",key:_},{default:a(()=>[e(n,{cols:"1"},{default:a(()=>[e(O,null,{default:a(()=>[V("Opción "+ee(_+1)+" : ",1)]),_:2},1024)]),_:2},1024),e(n,{cols:"4"},{default:a(()=>[e(x,{clearable:"",modelValue:i.name,"onUpdate:modelValue":M=>i.name=M,rules:[t(f)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]),_:2},1024))),128))],8,se)):(v(),g("td",{key:1,colspan:Q.length},[e(d,{class:"my-1"},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[re]),_:1})]),_:1})],8,ne))])]),"item.question":a(({item:o})=>[e(d,{class:"my-5"},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(A,{clearable:"",modelValue:o.raw.question,"onUpdate:modelValue":i=>o.raw.question=i,rules:[t(f)],"error-messages":t(m).question,onKeypress:l[13]||(l[13]=i=>t(m).question="")},null,8,["modelValue","onUpdate:modelValue","rules","error-messages"])]),_:2},1024)]),_:2},1024)]),bottom:a(()=>[]),_:1},8,["items"])]),_:1})]),_:1}),e(d,null,{default:a(()=>[e(n,{cols:"12 d-flex justify-content-center"},{default:a(()=>[e(b,{color:"primary",onClick:l[14]||(l[14]=o=>P())},{default:a(()=>[V("Guardar")]),_:1})]),_:1})]),_:1})])}}});export{ye as _};
