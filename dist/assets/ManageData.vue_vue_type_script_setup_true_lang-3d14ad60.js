import{i as se,Y as ne,s as ue,r as f,U as L,l as de,o as d,c as E,d as e,p as a,C as n,q as x,b as V,B as m,n as t,R as v,T as p,L as b,K as I,W as R,z as ce,V as N,x as O,t as W,O as fe,P as me,a as Q,a6 as ve}from"./index-c9350ca5.js";import{_ as ye}from"./InfoRequeriment.vue_vue_type_script_setup_true_lang-8c6f1ddb.js";import{useRequirementStore as _e}from"./useRequirementStore-d9b1061a.js";import{V as ke}from"./VTextarea-7e773ba2.js";import{V as K}from"./VTooltip-7bf3ee5c.js";import{V as P}from"./VDataTable-1f115dfc.js";const Ve=Q("h3",null,"Trazabilidad",-1),pe=["href","download"],ze=se({__name:"ManageData",setup(be){const U=ne(),y=_e(),{formularioManage:_,charges:g,arrayAction:Y,dataTraceability:H,requirementData:z}=ue(y),A=f([]),h=f(),$=f(),M=f(),k=f(L()),F=f(L()),u=f({}),S=f([]),T=async r=>{y.typeAction=r,r!="back"&&y.keyList++},J=async(r="save")=>{var c,i;const l=await((c=h.value)==null?void 0:c.validate());if(l!=null&&l.valid){const s=await y.fetchManageSave();s.code===200&&(await((i=h.value)==null?void 0:i.resetValidation()),A.value=[],y.clearFormularioManage(),r=="saveAndBack"&&T("list")),s.code===422&&(A.value=s.errors??[])}},X=async()=>{var l,c,i;const r=await((l=h.value)==null?void 0:l.validate());if(r!=null&&r.valid){const s=await((c=M.value)==null?void 0:c.validate());s!=null&&s.valid&&(u.value.archive_final=null,F.value.imageFile&&(u.value.archive_final=F.value.imageFile),(await y.fetchManageSave(u.value)).code===200&&(await((i=h.value)==null?void 0:i.resetValidation()),A.value=[],y.clearFormularioManage(),T("list"))),data.code===422&&(A.value=data.errors??[])}},Z=[{title:"Nombre",key:"name"},{title:"Acciones",sortable:!1,key:"actions"}],ee=de(()=>_.value.files.filter(r=>r.delete!="delete")),ae=()=>{k.value.clearData()},le=async()=>{var l;const r=await((l=$.value)==null?void 0:l.validate());r!=null&&r.valid&&(_.value.files.push({file:k.value.imageFile,name:k.value.name,delete:null,id:null}),ae())},te=r=>{_.value.files[r].id?_.value.files[r].delete="delete":_.value.files.splice(r,1)},B=f(!0),D=f("Guardar y Ejecutar"),re=r=>{B.value=!0;const l=g.value.findIndex(i=>i.id==U.user.charge_id),c=g.value[g.value.length-1];if(u.value.action=r,r=="Devolver"&&(u.value.where=null,S.value=g.value.filter((i,s)=>s<l)),r=="Continuar"){c.id==U.user.charge_id&&(D.value="Guardar y Finalizar",B.value=!1,u.value.action="Finalizar"),u.value.where=null;const i=l+1;S.value=g.value.filter((s,C)=>C==i)}},oe=[{title:"Cargo",key:"charge_name"},{title:"Usuario",key:"user_name"},{title:"ObservaciÃ³n",key:"observation"},{title:"Archivos",key:"files"},{title:"Fecha",key:"date"}],ie=()=>{u.value.action=null,D.value="Guardar y Ejecutar"};return(r,l)=>{var c,i,s,C,q,j;return d(),E("div",null,[e(m,null,{default:a(()=>[e(n,{cols:"12",class:"d-flex justify-content-end"},{default:a(()=>[e(x,{color:"secondary",onClick:l[0]||(l[0]=o=>T("back"))},{default:a(()=>[V(" Atras ")]),_:1})]),_:1})]),_:1}),t(z)?(d(),v(m,{key:0},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(ye)]),_:1})]),_:1})):p("",!0),((i=(c=t(z))==null?void 0:c.state)==null?void 0:i.id)!=3?(d(),v(I,{key:1,ref_key:"formValidation",ref:h,"lazy-validation":""},{default:a(()=>[e(m,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(ke,{modelValue:t(_).observation,"onUpdate:modelValue":l[1]||(l[1]=o=>t(_).observation=o),label:"Observaciones",rules:[t(b)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)):p("",!0),((C=(s=t(z))==null?void 0:s.state)==null?void 0:C.id)!=3?(d(),v(I,{key:2,ref_key:"formFileValidation",ref:$,"lazy-validation":""},{default:a(()=>[e(m,null,{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[(d(),v(R,{onChange:t(k).handleImageSelected,rules:[t(b)],key:t(k).key},null,8,["onChange","rules"]))]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(ce,{clearable:"",modelValue:t(k).name,"onUpdate:modelValue":l[2]||(l[2]=o=>t(k).name=o),rules:[t(b)],label:"Nombre"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(x,{color:"primary",icon:"",size:"35",onClick:l[3]||(l[3]=o=>le())},{default:a(()=>[e(N,{icon:"tabler-plus"}),e(K,{activator:"parent",location:"top"},{default:a(()=>[V("Agregar Archivo")]),_:1})]),_:1})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(t(P),{headers:Z,"items-per-page":"999",items:t(ee)},{"item.actions":a(({item:o,index:w})=>[e(x,{size:"x-small",color:"error",variant:"text",icon:"",onClick:G=>te(w)},{default:a(()=>[e(N,{size:"22",icon:"tabler-trash"}),e(K,{activator:"parent",location:"top"},{default:a(()=>[V("Borrar")]),_:1})]),_:2},1032,["onClick"])]),bottom:a(()=>[]),_:1},8,["items"])]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(n,{cols:"12 d-flex justify-content-center"},{default:a(()=>[e(x,{color:"primary",onClick:l[4]||(l[4]=o=>J("saveAndBack"))},{default:a(()=>[V("Guardar y salir")]),_:1})]),_:1})]),_:1})]),_:1},512)):p("",!0),((j=(q=t(z))==null?void 0:q.state)==null?void 0:j.id)!=3?(d(),v(I,{key:3,ref_key:"formExecuteValidation",ref:M,"lazy-validation":""},{default:a(()=>[e(m,null,{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(O,{rules:[t(b)],clearable:"",label:"Que hacer","onClick:clear":l[5]||(l[5]=o=>ie()),"onUpdate:modelValue":l[6]||(l[6]=o=>re(o)),items:t(Y)},null,8,["rules","items"])]),_:1}),t(B)?(d(),v(n,{key:0,cols:"4"},{default:a(()=>[e(O,{rules:[t(b)],clearable:"",label:"A donde","item-value":"id","item-title":"name",items:t(S),modelValue:t(u).where,"onUpdate:modelValue":l[7]||(l[7]=o=>t(u).where=o)},null,8,["rules","items","modelValue"])]),_:1})):p("",!0),t(u).action=="Finalizar"?(d(),v(n,{key:1,cols:"4"},{default:a(()=>[(d(),v(R,{onChange:t(F).handleImageSelected,"onClick:clear":t(F).clearData,rules:[t(b)],key:t(F).key},null,8,["onChange","onClick:clear","rules"]))]),_:1})):p("",!0),e(n,{cols:"4"},{default:a(()=>[e(x,{color:"primary",onClick:l[8]||(l[8]=o=>X())},{default:a(()=>[V(W(t(D)),1)]),_:1})]),_:1})]),_:1})]),_:1},512)):p("",!0),e(m,{class:"mt-5"},{default:a(()=>[e(n,null,{default:a(()=>[Ve,e(t(P),{headers:oe,items:t(H),"items-per-page":99999999},{"item.files":a(({item:o})=>[(d(!0),E(fe,null,me(o.raw.files,(w,G)=>(d(),E("div",{class:"d-flex flex-column my-2",key:G},[Q("a",{class:"my-2",href:w.path,target:"_blank",download:w.name},[e(ve,{color:"primary",style:{cursor:"pointer"}},{default:a(()=>[e(N,{start:"",size:"16",icon:"tabler-download"}),V(" "+W(w.name),1)]),_:2},1024)],8,pe)]))),128))]),bottom:a(()=>[]),_:1},8,["items"])]),_:1})]),_:1})])}}});export{ze as _};
