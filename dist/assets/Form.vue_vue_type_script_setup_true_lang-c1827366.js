import{e as ee,x as ae,y as _,B as le,o as y,c as k,d as e,h as t,w as a,J as te,R as U,K as f,L as n,H as C,T as p,b as c,a as u,U as $,g as P,m as w,I as N,V as Q,E as se,O as D,F as E,P as h,Q as oe,W as ne,t as re,X as ue,S as ie,Y as de,Z as me}from"./index-dd53741e.js";import{a as L,_ as ce}from"./HeaderAlertView.vue_vue_type_script_setup_true_lang-e1c88155.js";import{useCrudSurveyStore as pe}from"./useCrudSurveyStore-07fe3bda.js";import{V as S}from"./VTooltip-c58f227b.js";import{V as fe}from"./VDataTable-d1d16a2f.js";const ve=u("b",{class:"text-warning"},"*",-1),_e=u("dt",null,[c(" Fecha inicio "),u("b",{class:"text-warning"},"*")],-1),ye=u("dt",null,[c(" Fecha fin "),u("b",{class:"text-warning"},"*")],-1),Ve={class:"d-flex"},ge=u("b",{class:"text-vblack fs-6 me-auto"},"Preguntas",-1),be=u("b",{class:"text-warning"},"*",-1),ke=u("b",{class:"text-warning"},"*",-1),we={class:"v-data-table__tr"},qe=["colspan"],xe=["colspan"],Ce=u("b",null,"Esta tipo de pregunta no posee opciones asociadas",-1),De=ee({__name:"Form",setup(Qe){const q=pe(),{action:K,formulario:r}=ae(q),d=_([]),T=_(),z=_(),B=_(),R=[{value:1,title:"Si"},{value:0,title:"No"}],F=async o=>{var l;q.typeAction=o,await((l=T.value)==null?void 0:l.resetValidation()),d.value=[],o!="back"&&q.keyList++},G=async()=>{var l;const o=await((l=T.value)==null?void 0:l.validate());if(o!=null&&o.valid){const V=await q.fetchSave();V.code===200&&F("list"),V.code===422&&(d.value=V.errors??[])}},m=_({question:null,type_question:null}),x=_({name:null}),v=_([]),A=_([{value:1,title:"Abierta"},{value:2,title:"Cerrada"},{value:3,title:"Multiple"}]),H=async()=>{m.value={question:null,type_question:null,arrayOptions:[]}},I=async()=>{var l;const o=await((l=z.value)==null?void 0:l.validate());if(o!=null&&o.valid){if(m.value.type_question!=1&&v.value.length==0)return ie.fire("Debe agregar almenos una opción  a la pregunta"),!1;const V=A.value.find(g=>g.value==m.value.type_question);r.value.arrayQuestions.push({question:m.value.question,type_question:m.value.type_question,type_name:V.title,arrayOptions:[]}),v.value.forEach(g=>{r.value.arrayQuestions[r.value.arrayQuestions.length-1].arrayOptions.push(g)}),H()}},J=async o=>{r.value.arrayQuestions[o].id?r.value.arrayQuestions[o].delete="delete":r.value.arrayQuestions.splice(o,1)},M=le(()=>r.value.arrayQuestions.filter(o=>o.delete!="delete")),O=[{title:"",key:"data-table-expand",sortable:!1},{title:"Pregunta",key:"question",sortable:!1},{title:"Tipo de pregunta",key:"type_name",sortable:!1},{title:"Acciones",key:"actions",sortable:!1}],W=async()=>{var l;const o=await((l=B.value)==null?void 0:l.validate());o!=null&&o.valid&&(v.value.push({name:x.value.name}),x.value={name:null})},X=async o=>{v.value[o].id?v.value[o].delete="delete":v.value.splice(o,1)},Y=()=>{v.value=[]};return(o,l)=>{const V=ce,g=de,Z=me;return y(),k("div",null,[e(V,{"sub-title":"Encuesta",action:t(K),"validate-crud":!0,"btn-back":!0,onChangeScreenBack:l[0]||(l[0]=s=>F("back"))},null,8,["action"]),e(ue,null,{default:a(()=>[e(te,null,{default:a(()=>[e(U,{ref_key:"formValidation",ref:T,"lazy-validation":""},{default:a(()=>[e(f,null,{default:a(()=>[e(n,{cols:"12",md:"4"},{default:a(()=>[e(C,{class:"mt-6",modelValue:t(r).name,"onUpdate:modelValue":l[1]||(l[1]=s=>t(r).name=s),rules:[t(p)],"error-messages":t(d).name,onKeypress:l[2]||(l[2]=s=>t(d).name="")},{label:a(()=>[c(" Nombre "),ve]),_:1},8,["modelValue","rules","error-messages"])]),_:1}),e(n,{cols:"12",sm:"6",md:"4"},{default:a(()=>[u("dl",null,[_e,u("dd",null,[e(g,{modelValue:t(r).startDate,"onUpdate:modelValue":l[3]||(l[3]=s=>t(r).startDate=s),rules:[t(p)],"error-messages":t(d).startDate,onChange:l[4]||(l[4]=s=>t(d).startDate="")},null,8,["modelValue","rules","error-messages"])])])]),_:1}),e(n,{cols:"12",sm:"6",md:"4"},{default:a(()=>[u("dl",null,[ye,u("dd",null,[e(g,{modelValue:t(r).endDate,"onUpdate:modelValue":l[5]||(l[5]=s=>t(r).endDate=s),rules:[t(p)],"error-messages":t(d).endDate,onChange:l[6]||(l[6]=s=>t(d).endDate="")},null,8,["modelValue","rules","error-messages"])])])]),_:1}),e(n,{cols:"12",sm:"4"},{default:a(()=>[e(Z,{clearable:"",items:R,modelValue:t(r).answerSeveralTimes,"onUpdate:modelValue":l[7]||(l[7]=s=>t(r).answerSeveralTimes=s),rules:[t(p)],"error-messages":t(d).answerSeveralTimes,onChange:l[8]||(l[8]=s=>t(d).answerSeveralTimes=""),label:"Puede responder varias veces"},null,8,["modelValue","rules","error-messages"])]),_:1}),e(n,{cols:"12"},{default:a(()=>[e($,{rows:"2",label:"Descripción",class:"mt-6",modelValue:t(r).description,"onUpdate:modelValue":l[9]||(l[9]=s=>t(r).description=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512),e(U,{ref_key:"formQuestionValidation",ref:z,"lazy-validation":""},{default:a(()=>[e(f,null,{default:a(()=>[e(n,{cols:"12",class:"pb-0"},{default:a(()=>[e(P,{class:"border-opacity-75 mb-3",color:"csecundary",thickness:3}),u("div",Ve,[e(L,{class:"w-100"},{default:a(()=>[ge]),_:1}),e(L,null,{default:a(()=>[e(S,{text:"Pregunta",location:"top"},{activator:a(({props:s})=>[e(w,N({class:"ms-1",color:"light",rounded:"lg"},s,{onClick:l[10]||(l[10]=i=>I())}),{default:a(()=>[c(" Agregar  "),e(Q,{size:"large",color:"success",icon:"mdi-plus"})]),_:2},1040)]),_:1})]),_:1})])]),_:1}),e(n,{cols:"12",sm:"6"},{default:a(()=>[e(se,{clearable:"",rules:[t(p)],"onUpdate:modelValue":[l[11]||(l[11]=s=>Y()),l[12]||(l[12]=s=>t(m).type_question=s)],items:t(A),modelValue:t(m).type_question},{label:a(()=>[c(" Tipo de pregunta "),be]),_:1},8,["rules","items","modelValue"])]),_:1}),e(n,{cols:"12"},{default:a(()=>[e($,{clearable:"",modelValue:t(m).question,"onUpdate:modelValue":l[13]||(l[13]=s=>t(m).question=s),rules:[t(p)]},{label:a(()=>[c(" Pregunta "),ke]),_:1},8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512),t(m).type_question&&t(m).type_question!=1?(y(),D(U,{key:0,ref_key:"formOptionValidation",ref:B,"lazy-validation":""},{default:a(()=>[e(f,null,{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(C,{clearable:"",modelValue:t(x).name,"onUpdate:modelValue":l[14]||(l[14]=s=>t(x).name=s),rules:[t(p)],label:"Opción"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(w,{onClick:l[15]||(l[15]=s=>W())},{default:a(()=>[c(" Agregar Opción ")]),_:1})]),_:1})]),_:1}),(y(!0),k(E,null,h(t(v),(s,i)=>(y(),D(f,{key:i},{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(C,{modelValue:s.name,"onUpdate:modelValue":b=>s.name=b,rules:[t(p)],label:"Opción #"+(i+1)},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),e(n,{cols:"4"},{default:a(()=>[e(w,{size:"x-small",color:"error",variant:"text",icon:"",onClick:b=>X(i)},{default:a(()=>[e(Q,{size:"22",icon:"tabler-trash"}),e(S,{activator:"parent",location:"top"},{default:a(()=>[c("Borrar")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},512)):oe("",!0),e(f,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(t(fe),{headers:O,items:t(M)},{"item.actions":a(({item:s,index:i})=>[e(w,{size:"x-small",color:"error",variant:"text",icon:"",onClick:b=>J(i)},{default:a(()=>[e(Q,{size:"22",icon:"tabler-trash"}),e(S,{activator:"parent",location:"top"},{default:a(()=>[c("Borrar")]),_:1})]),_:2},1032,["onClick"])]),"expanded-row":a(s=>[u("tr",we,[s.item.raw.arrayOptions.length>0?(y(),k("td",{key:0,colspan:O.length},[(y(!0),k(E,null,h(s.item.raw.arrayOptions,(i,b)=>(y(),D(f,{class:"my-1",key:b},{default:a(()=>[e(n,{cols:"1"},{default:a(()=>[e(ne,null,{default:a(()=>[c("Opción "+re(b+1)+" : ",1)]),_:2},1024)]),_:2},1024),e(n,{cols:"12"},{default:a(()=>[e(C,{clearable:"",modelValue:i.name,"onUpdate:modelValue":j=>i.name=j,rules:[t(p)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024)]),_:2},1024))),128))],8,qe)):(y(),k("td",{key:1,colspan:O.length},[e(f,{class:"my-1"},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[Ce]),_:1})]),_:1})],8,xe))])]),"item.question":a(({item:s})=>[e(f,{class:"my-5"},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e($,{clearable:"",modelValue:s.raw.question,"onUpdate:modelValue":i=>s.raw.question=i,rules:[t(p)],"error-messages":t(d).question,onKeypress:l[16]||(l[16]=i=>t(d).question="")},null,8,["modelValue","onUpdate:modelValue","rules","error-messages"])]),_:2},1024)]),_:2},1024)]),bottom:a(()=>[]),_:1},8,["items"])]),_:1})]),_:1}),e(P,{class:"border-opacity-75 my-4",color:"cprimary",thickness:3}),e(f,{class:"pt-0"},{default:a(()=>[e(n,{class:"text-center",cols:"12"},{default:a(()=>[e(S,{text:"Guardar",location:"top"},{activator:a(({props:s})=>[e(w,N({class:"ms-1",color:"light",rounded:"lg"},s,{onClick:l[17]||(l[17]=i=>G())}),{default:a(()=>[c(" Guardar  "),e(Q,{size:"large",color:"success",icon:"mdi-content-save-outline"})]),_:2},1040)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}});export{De as _};
